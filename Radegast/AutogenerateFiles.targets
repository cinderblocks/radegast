<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask TaskName="GenerateFile" TaskFactory="RoslynCodeTaskFactory" AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.Core.dll">
    <ParameterGroup>
	    <Filename ParameterType="System.String" Required="true" />
    </ParameterGroup>
	<Task>
	  <Using Namespace="System" />
	  <Using Namespace="System.IO" />
	  <Code Type="Fragment" Language="cs">
<![CDATA[
var value = "$(BugsplatDatabase)";
if (string.IsNullOrEmpty(value)) { value = ""; }

string context = File.Exists(Filename) ? File.ReadAllText(Filename) : "";

var sb = new StringBuilder();
sb.AppendLine("/*");
sb.AppendLine(" * Autogenerated by Radegast.csproj. Do not edit, your modifications will be lost after the next file generation!");
sb.AppendLine(" */");
sb.AppendLine();
sb.AppendLine("namespace Radegast");
sb.AppendLine("{");
sb.AppendLine("    public static partial class Generated");
sb.AppendLine("    {");
sb.AppendLine($"       public static readonly string BugsplatDatabase = \"{value}\";");
sb.AppendLine("    }");
sb.AppendLine("} // namespace Radegast");
string output = sb.ToString();

if (output != context) { File.WriteAllText(Filename, output); }
]]>
	  </Code>
	</Task>
  </UsingTask>
</Project>